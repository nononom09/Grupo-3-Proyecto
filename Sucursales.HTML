<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Little Caesars Pizza</title>
<link rel="icon" href="logo.jpg">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"/>

<style>
#map, .branch-map, .leaflet-container * {
    z-index: 1 !important;
}

.modal, .modal * {
    z-index: 9999 !important;
}

:root{
  --brand:#ff6600;
  --brand-dark:#e65500;
  --dark:#222;
  --muted:#6b6b6b;
  --bg:#fafafa;
  --card:#fff;
  --cluster-bg: #ff6600;
  --cluster-text: #fff;
}

*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:var(--bg);color:var(--dark);-webkit-font-smoothing:antialiased}

/* Header */
header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:12px 40px;
  background:#ff6600;
  box-shadow:0 2px 8px rgba(0,0,0,.15);
  position:sticky;
  top:0;
  z-index:100;
}

.header-left{
  display:flex;
  align-items:center;
  gap:12px;
}

header img{
  height:50px;
  background:#fff;
  padding:4px;
  border-radius:8px;
}

.brand{
  font-weight:800;
  font-size:1.3rem;
  color:#fff;
  text-shadow:1px 1px 2px rgba(0,0,0,.2);
}

/* Navigation */
nav{
  display:flex;
  gap:30px;
  align-items:center;
}

nav a{
  color:#fff;
  text-decoration:none;
  font-weight:700;
  font-size:0.95rem;
  text-transform:uppercase;
  letter-spacing:0.5px;
  padding:8px 16px;
  border-radius:6px;
  transition:all 0.3s ease;
  position:relative;
}

nav a:hover{
  background:rgba(255,255,255,0.15);
  transform:translateY(-2px);
}

nav a.active{
  background:rgba(255,255,255,0.2);
  box-shadow:0 2px 8px rgba(0,0,0,.1);
}

.container{
  max-width:1600px;
  margin:0 auto;
  padding:20px 24px;
}

/* Search */
.search-wrap{
  display:flex;
  justify-content:center;
  margin:24px 0;
}

.search-box{
  width:100%;
  max-width:700px;
  display:flex;
  align-items:center;
  background:#fff;
  border-radius:50px;
  padding:6px 8px;
  border:2px solid #e0e0e0;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
  transition:all 0.3s ease;
}

.search-box:focus-within{
  border-color:var(--brand);
  box-shadow:0 6px 20px rgba(255,102,0,.15);
  transform:translateY(-2px);
}

.search-input{
  flex:1;
  border:0;
  padding:12px 18px;
  font-size:16px;
  outline:none;
  border-radius:50px;
}

.search-btn{
  background:var(--brand);
  border:0;
  color:#fff;
  padding:12px 24px;
  border-radius:50px;
  font-weight:700;
  cursor:pointer;
  transition:all 0.3s ease;
  text-transform:uppercase;
  font-size:14px;
}

.search-btn:hover{
  background:var(--brand-dark);
  transform:scale(1.05);
}

.suggestions{
  max-width:700px;
  margin:8px auto 0;
  background:#fff;
  border-radius:12px;
  border:1px solid #e6e6e6;
  box-shadow:0 8px 24px rgba(0,0,0,.1);
  overflow:hidden;
  display:none;
  position:relative;
  z-index:60;
}

.suggestion-item{
  padding:12px 18px;
  cursor:pointer;
  border-bottom:1px solid #f4f4f4;
  transition:all 0.2s ease;
}

.suggestion-item:last-child{border-bottom:0}
.suggestion-item:hover{
  background:#fff6ee;
  padding-left:24px;
}

/* Main Layout - Two columns */
.main-layout{
  display:grid;
  grid-template-columns:1fr 650px;
  gap:24px;
  margin-top:24px;
  align-items:start;
}

/* Left Column - Branch Cards */
.branches-column{
  display:flex;
  flex-direction:column;
  gap:0;
}

.results-head{
  background:#fff;
  padding:16px 20px;
  border-radius:12px 12px 0 0;
  display:flex;
  align-items:center;
  justify-content:space-between;
  border-bottom:3px solid var(--brand);
  margin-bottom:0;
}

.results-head h2{
  margin:0;
  font-size:1.3rem;
  color:var(--brand);
  font-weight:800;
}

.count-badge{
  background:var(--brand);
  color:#fff;
  padding:4px 12px;
  border-radius:20px;
  font-size:0.85rem;
  font-weight:700;
}

/* Branch Cards - Matching the design */
#cards{
  display:flex;
  flex-direction:column;
  gap:0;
  background:#fff;
  border-radius:0 0 12px 12px;
  overflow:hidden;
  box-shadow:0 4px 16px rgba(0,0,0,.06);
}

.branch-card{
  padding:20px 24px;
  border-bottom:1px solid #e8e8e8;
  transition:all 0.3s ease;
  cursor:pointer;
  background:#fff;
}

.branch-card:last-child{
  border-bottom:0;
  border-radius:0 0 12px 12px;
}

.branch-card:hover{
  background:#fffbf7;
  box-shadow:inset 0 0 0 2px var(--brand);
}

.branch-card h3{
  color:var(--brand);
  font-size:1.1rem;
  margin:0 0 8px 0;
  font-weight:800;
  text-transform:uppercase;
  cursor:pointer;
}

.branch-card h3:hover{
  text-decoration:underline;
}

.branch-card .city{
  color:var(--muted);
  font-size:0.9rem;
  margin-bottom:8px;
  font-weight:600;
}

.branch-card .address{
  color:var(--dark);
  font-size:0.9rem;
  line-height:1.5;
  margin-bottom:12px;
}

.branch-card .hours{
  font-size:0.85rem;
  line-height:1.6;
  margin-bottom:16px;
}

.branch-card .hours strong{
  color:var(--dark);
  font-weight:700;
}

.branch-actions{
  display:flex;
  gap:12px;
  align-items:center;
}

.order-btn{
  background:var(--brand);
  border:2px solid var(--brand);
  color:#fff;
  padding:10px 20px;
  border-radius:6px;
  font-weight:700;
  cursor:pointer;
  transition:all 0.3s ease;
  text-transform:uppercase;
  font-size:13px;
  display:inline-flex;
  align-items:center;
  gap:6px;
}

.order-btn:hover{
  background:var(--brand-dark);
  border-color:var(--brand-dark);
  transform:translateY(-2px);
  box-shadow:0 4px 12px rgba(255,102,0,.3);
}

.fav-btn{
  background:transparent;
  border:2px solid #ddd;
  color:#999;
  padding:10px 14px;
  border-radius:6px;
  cursor:pointer;
  transition:all 0.3s ease;
  font-size:18px;
  line-height:1;
}

.fav-btn:hover{
  border-color:var(--brand);
  color:var(--brand);
  transform:scale(1.1);
}

.fav-btn.active{
  background:var(--brand);
  color:#fff;
  border-color:var(--brand);
}

.map-btn{
  background:transparent;
  border:2px solid #ddd;
  color:#666;
  padding:10px 14px;
  border-radius:6px;
  cursor:pointer;
  transition:all 0.3s ease;
  font-size:16px;
  line-height:1;
}

.map-btn:hover{
  border-color:var(--brand);
  color:var(--brand);
  background:#fff6ee;
}

/* Right Column - Map and Favorites */
.map-column{
  position: sticky;
  top: 0; /* antes estaba 90px */
  display: flex;
  flex-direction: column;
  gap: 20px;
}


.map-panel{
  background:#fff;
  border-radius:12px;
  padding:20px;
  box-shadow:0 4px 16px rgba(0,0,0,.06);
}

.map-panel h3{
  color:var(--brand);
  font-size:1.2rem;
  margin:0 0 16px 0;
  font-weight:800;
}

.mapbox{
  height:400px;
  border-radius:12px;
  overflow:hidden;
  border:2px solid #eee;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}

/* Favorites section */
.favorites-panel{
  background:#fff;
  border-radius:12px;
  padding:20px;
  box-shadow:0 4px 16px rgba(0,0,0,.06);
}

.favorites-panel.hidden{
  display:none;
}

.favorites-header{
  display:flex;
  align-items:center;
  gap:8px;
  margin-bottom:16px;
  color:var(--brand);
  font-weight:800;
  font-size:1.1rem;
}

.favorites-header::before{
  content:'‚òÖ';
  font-size:1.3rem;
}

.favorites-list{
  display:flex;
  flex-direction:column;
  gap:12px;
  max-height:300px;
  overflow-y:auto;
  padding-right:4px;
}

.favorites-list::-webkit-scrollbar{width:6px}
.favorites-list::-webkit-scrollbar-track{background:#f1f1f1;border-radius:10px}
.favorites-list::-webkit-scrollbar-thumb{background:var(--brand);border-radius:10px}

.fav-item{
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:space-between;
  padding:12px;
  border-radius:8px;
  border:1px solid #f1f1f1;
  background:#fafafa;
  cursor:pointer;
  transition:all 0.3s ease;
}

.fav-item:hover{
  border-color:var(--brand);
  background:#fff6ee;
  transform:translateX(4px);
}

.fav-item-info h4{
  margin:0;
  color:var(--brand);
  font-size:0.9rem;
  font-weight:700;
}

.fav-item-info p{
  margin:4px 0 0;
  color:var(--muted);
  font-size:12px;
}

.fav-item-btn{
  background:var(--brand);
  border:0;
  color:#fff;
  padding:8px 14px;
  border-radius:6px;
  font-weight:700;
  cursor:pointer;
  font-size:11px;
  text-transform:uppercase;
  white-space:nowrap;
  transition:all 0.3s ease;
}

.fav-item-btn:hover{
  background:var(--brand-dark);
  transform:scale(1.05);
}

/* Empty state */
.empty-state{
  text-align:center;
  padding:40px 20px;
  color:var(--muted);
}

.empty-state::before{
  content:'‚òÖ';
  font-size:48px;
  display:block;
  margin-bottom:12px;
  opacity:0.3;
}

/* Modal general */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.65);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:200;
  padding:20px;
  backdrop-filter:blur(4px);
}

.modal-box{
  background:#fff;
  border-radius:16px;
  padding:28px;
  max-width:900px;
  width:100%;
  position:relative;
  display:grid;
  grid-template-columns:1fr 380px;
  gap:24px;
  box-shadow:0 20px 60px rgba(0,0,0,.3);
  animation:modalSlideIn 0.3s ease;
}

@keyframes modalSlideIn{
  from{opacity:0;transform:translateY(-30px)}
  to{opacity:1;transform:translateY(0)}
}

.modal-close{
  position:absolute;
  right:16px;
  top:12px;
  font-size:28px;
  cursor:pointer;
  color:#999;
  transition:all 0.3s ease;
  width:36px;
  height:36px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:50%;
}

.modal-close:hover{
  background:#f0f0f0;
  color:var(--brand);
  transform:rotate(90deg);
}

/* Order chooser modal */
.order-modal-box{
  background:#fff;
  border-radius:16px;
  padding:32px;
  max-width:600px;
  width:100%;
  text-align:center;
  animation:modalSlideIn 0.3s ease;
}

.order-modal-box h2{
  color:var(--brand);
  margin-bottom:16px;
}

.providers{
  display:flex;
  gap:20px;
  justify-content:center;
  margin-top:28px;
}

.provider{
  flex:1;
  padding:20px;
  border-radius:12px;
  border:3px solid #ddd;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:12px;
  transition:all 0.3s ease;
}

.provider:hover{
  transform:translateY(-4px);
  box-shadow:0 8px 24px rgba(0,0,0,.15);
}

.provider.uber{border-color:#1dbf73}
.provider.uber:hover{background:#f0fff8}
.provider.pya{border-color:#ff3b3b}
.provider.pya:hover{background:#fff5f5}

/* Branch map styling */
.branch-info h3{
  margin:0 0 12px 0;
  color:var(--brand);
  font-size:1.4rem;
}

.branch-info p{
  margin:8px 0;
  color:var(--muted);
  font-size:14px;
  line-height:1.6;
}

.branch-map{
  height:320px;
  border-radius:12px;
  border:2px solid #eee;
  overflow:hidden;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}

/* Cluster styles */
.leaflet-marker-icon.small-logo{
  border-radius:50%;
  box-shadow:0 4px 12px rgba(0,0,0,.25);
  border:3px solid #fff;
}

.marker-cluster-small{
  background-color:var(--cluster-bg);
  border-radius:50%;
  color:var(--cluster-text);
  text-align:center;
  border:4px solid #fff;
  box-shadow:0 4px 12px rgba(0,0,0,.3);
}

.marker-cluster-small div{
  line-height:36px;
  font-weight:800;
  font-size:14px;
}

/* Responsive */
@media(max-width:1200px){
  .main-layout{
    grid-template-columns:1fr;
  }
  .map-column{
    position:relative;
    top:0;
  }
  .modal-box{
    grid-template-columns:1fr;
    max-width:600px;
  }
}

@media(max-width:768px){
  nav{display:none}
  .brand{font-size:1.1rem}
  header{padding:12px 20px}
  .providers{flex-direction:column}
}

.sr-only{
  position:absolute;
  height:1px;
  width:1px;
  overflow:hidden;
  clip:rect(1px,1px,1px,1px);
  white-space:nowrap;
}
</style>
</head>
<body>

<header>
  <div class="header-left">
    <img src="logo.jpg" alt="Little Caesars Logo">
    <div class="brand">Little Caesars Pizza</div>
  </div>
  <nav aria-label="Navegaci√≥n principal">
    <a href="incio.html" class="active">INICIO</a>
    <a href="#menu">MEN√ö</a>
    <a href="#nosotros">ACERCA DE NOSOTROS</a>
    <a href="Sucursales.HTML">SUCURSALES</a>
  </nav>
</header>

<main class="container" role="main">
  <div class="search-wrap">
    <div class="search-box" role="search" aria-label="Buscar sucursal">
      <input id="searchInput" class="search-input" type="search" placeholder="Buscar sucursal o ciudad‚Ä¶" aria-label="Buscar sucursal" autocomplete="off">
      <button id="searchBtn" class="search-btn" aria-label="Buscar">Buscar</button>
    </div>
  </div>

  <div id="autocomplete" class="suggestions" role="listbox" aria-label="Sugerencias"></div>

  <div class="main-layout">
    <!-- Left Column: Branch Cards -->
    <div class="branches-column">
      <div class="results-head">
        <h2>Sucursales</h2>
        <span class="count-badge"><span id="count">0</span> resultados</span>
      </div>
      <div id="cards"></div>
    </div>

    <!-- Right Column: Map and Favorites -->
    <div class="map-column">
      <div class="map-panel">
        <h3>Mapa General</h3>
        <div id="map" class="mapbox" role="region" aria-label="Mapa de sucursales"></div>
      </div>

      <div class="favorites-panel" id="favoritesPanel">
        <div class="favorites-header">Favoritos</div>
        <div id="favoritesList" class="favorites-list"></div>
        <div id="emptyFavorites" class="empty-state" style="display:none">
          <p>No tienes sucursales favoritas</p>
          <p style="font-size:12px;margin-top:8px">Haz clic en ‚òÖ para agregar favoritos</p>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Branch modal -->
<div id="branchModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal-box" role="document">
    <div class="modal-close" id="closeBranch">‚úï</div>
    <div class="branch-info">
      <h3 id="bName"></h3>
      <p id="bAddress"></p>
      <p><strong>Horario Lunes‚ÄìMiercoles:</strong> <span id="bH1"></span></p>
      <p><strong>Horario Jueves‚ÄìDomingo:</strong> <span id="bH2"></span></p>
      <p><strong>Tel√©fono:</strong> <span id="bPhone"></span></p>
      <div style="margin-top:20px;display:flex;gap:12px">
        <button class="order-btn" id="btnOrderHere">üçï ORDENAR AQU√ç</button>
        <button class="fav-btn" id="btnFav">‚òÜ</button>
      </div>
    </div>
    <div>
      <div id="branchMap" class="branch-map" aria-label="Mapa de sucursal"></div>
    </div>
  </div>
</div>

<!-- Order provider chooser modal -->
<div id="orderModal" class="modal" aria-hidden="true">
  <div class="order-modal-box" role="dialog" aria-modal="true">
    <div class="modal-close" id="closeOrder">‚úï</div>
    <h2>EST√ÅS SALIENDO DE LA P√ÅGINA DE LITTLE CAESARS</h2>
    <p style="margin-top:12px">Ser√°s redirigido a un proveedor externo para realizar tu pedido. Por favor selecciona una opci√≥n.</p>
    <div class="providers">
      <div class="provider uber" id="uberBtn" role="button" tabindex="0">
        <img src="uber.jpg" alt="Uber Eats" style="height:40px">
      </div>
      <div class="provider pya" id="pyaBtn" role="button" tabindex="0">
        <img src="pedido.jpg" alt="PedidosYa" style="height:40px">
      </div>
    </div>
    <p style="font-size:12px;color:var(--muted);margin-top:24px">Esta p√°gina ser√° manejada por un proveedor externo. Little Caesars no se responsabiliza por contenido externo.</p>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

<script>
const branches = [
{"id":1,"name":"ALMA ROSA","city":"Santo Domingo Este","address":"Carretera Mella, esquina Virgilio Mainardi Reyna, estaci√≥n de combustibles TEXACO, Alma Rosa","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295936224","lat":18.4800,"lng":-69.8200},
{"id":2,"name":"ALMACENES GARRIDO","city":"Santo Domingo Este","address":"Marginal Av. Las Am√©ricas KM 14 casi esq. Av. Hip√≥dromo","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295936222","lat":18.4790,"lng":-69.7800},
{"id":3,"name":"AUT. DUARTE","city":"Santo Domingo","address":"Autopista Duarte Km 10 1/2 estaci√≥n de combustibles Texaco La Salida","hours1":"10 am a 11 pm","hours2":"10 pm a 12 am","phone":"8295936216","lat":18.5000,"lng":-69.9000},
{"id":4,"name":"AUT. SAN ISIDRO","city":"Santo Domingo Este","address":"Calle Marginal Norte de la Autopista San Isidro esq. Calle Pompeya","hours1":"11 am a 10 pm","hours2":"11 am a 11 pm","phone":"8295936221","lat":18.4700,"lng":-69.8000},
{"id":5,"name":"AVENIDA ESPA√ëA","city":"Santo Domingo Este","address":"Avenida Espa√±a pr√≥ximo al Acuario Nacional, Estaci√≥n de Combustible Petrom√≥vil","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295936218","lat":18.4700,"lng":-69.9000},
{"id":6,"name":"AZUA","city":"Azua","address":"Avenida Duarte, esquina Ntra Sra. de F√°tima. Estaci√≥n de Combustible Shell Mambo","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":null,"lat":18.4560,"lng":-70.7440},
{"id":7,"name":"BAN√ç","city":"Ban√≠","address":"KM. 1 1/2. carretera S√°nchez. Estaci√≥n de Combustible Eco Petr√≥leo","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":null,"lat":18.3210,"lng":-70.2550},
{"id":8,"name":"BARRIO MEJORAMIENTO SOCIAL","city":"Santo Domingo","address":"Calle Josefa Brea, esq. Teniente Amado Garc√≠a. Estaci√≥n de combustible Texaco","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":null,"lat":18.4800,"lng":-69.9000},
{"id":9,"name":"BELLA VISTA, SANTIAGO","city":"Santiago","address":"Avenida Pte. Antonio Guzm√°n, no. 30. Estaci√≥n de combustible Shell","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":null,"lat":19.4500,"lng":-70.7000},
{"id":10,"name":"BOCA CHICA","city":"Boca Chica","address":"Autopista Las Am√©ricas km 29.5 Andr√©s Boca Chica. Estaci√≥n SIGMA La Caleta","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295472198","lat":18.4419,"lng":-69.6323},
{"id":11,"name":"BONAO","city":"Bonao","address":"Calle Duarte. Esquina doctor Columna. Estaci√≥n de combustible Atlantic","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":null,"lat":18.8290,"lng":-70.4019},
{"id":12,"name":"CHARLES DE GAULLE","city":"Santo Domingo Este","address":"Ave. Charles de Gaulle casi esq. Carretera Mella, Estaci√≥n de Combustible Next","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295936223","lat":18.4800,"lng":-69.8700},
{"id":13,"name":"COLINAS MALL, SANTIAGO","city":"Santiago","address":"Avenida 27 de febrero esquina Avenida Imbert, Plaza Colinas Mall, 3er Nivel","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8093321054","lat":19.4500,"lng":-70.7000},
{"id":14,"name":"COTU√ç","city":"Cotu√≠","address":"Plaza Paula, Prol. 27 de Febrero 50","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":null,"lat":19.0597,"lng":-70.0839},
{"id":15,"name":"ESTRELLA SADHAL√Å, SANTIAGO","city":"Santiago","address":"Avenida Estrella Sadhal√° esq. Carretera Jacagua, Estaci√≥n de Combustible Shell","hours1":"11 am a 11 pm","hours2":"11 am a 11 pm","phone":"8293782900","lat":19.4500,"lng":-70.7000},
{"id":16,"name":"FRIUSA","city":"Santo Domingo","address":"Avenida Espa√±a, esquina Estados Unidos, Friusa Center","hours1":"10 am a 12 pm","hours2":"10 am a 12 pm","phone":null,"lat":18.4861,"lng":-69.9312},
{"id":17,"name":"HAINA","city":"Haina","address":"Avenida R√≠o Haina #37 Plaza Cristal, Bajos de Haina, San Crist√≥bal","hours1":"10 am a 11 pm","hours2":"10 am a 11 pm","phone":null,"lat":18.4030,"lng":-70.1220},
{"id":18,"name":"HERMANAS MIRABAL","city":"Villa Mella","address":"Avenida Hermanas Mirabal #273, Antigua Ferreter√≠a Ventura, Villa Mella","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295472796","lat":18.5667,"lng":-69.8667},
{"id":19,"name":"HIG√úEY","city":"Hig√ºey","address":"Avenida Hermanos Trejo esq. Calle General Santana, Hig√ºey","hours1":"10 am a 12 pm","hours2":"10 am a 12 pm","phone":"8295472899","lat":18.6120,"lng":-68.7130},
{"id":20,"name":"INDEPENDENCIA","city":"Santo Domingo","address":"Av Independencia Km 8 1/2, Estaci√≥n de Combustible Petrom√≥vil, sector Miramar","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295936215","lat":18.4800,"lng":-69.9600},
{"id":21,"name":"JACOBO MAJLUTA","city":"Los Guaricanos","address":"Avenida Jacobo Majluta KM 4¬Ω, Los Guaricanos","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":null,"lat":18.6000,"lng":-69.9000},
{"id":22,"name":"LA H√çPICA","city":"Santo Domingo Este","address":"Avenida H√≠pica, Estaci√≥n de combustibles SIGMA sector Ciudad del Este","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295475750","lat":18.4700,"lng":-69.8600},
{"id":23,"name":"LA MONUMENTAL","city":"Santo Domingo","address":"Av Rep√∫blica de Colombia, casi esquina Av La Monumental, Estaci√≥n Next","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295947233","lat":18.4800,"lng":-69.9200},
{"id":24,"name":"LA ROMANA","city":"La Romana","address":"Estaci√≥n de Combustible Total Lumay. Autopista del Este (Al lado de Multiplaza La Romana)","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295936225","lat":18.4340,"lng":-68.9720},
{"id":25,"name":"LA VEGA","city":"La Vega","address":"Av. Imbert #5, Estaci√≥n de Combustible Petrom√≥vil","hours1":"11 am a 11 pm","hours2":"11 am a 11 pm","phone":"8295936227","lat":19.2136,"lng":-70.5296},
{"id":26,"name":"LA VECINA","city":"Santo Domingo","address":"Av. N√∫√±ez de C√°ceres estaci√≥n de combustibles Total La Vecina","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295936212","lat":18.4750,"lng":-69.9300},
{"id":27,"name":"LEOPOLDO NAVARRO","city":"Santo Domingo","address":"Avenida Leopoldo Navarro Estaci√≥n de Combustible Texaco Piloto","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":null,"lat":18.4800,"lng":-69.9500},
{"id":28,"name":"LOPE DE VEGA","city":"Santo Domingo","address":"Av. Lope de Vega esq. John F. Kennedy. Estaci√≥n de Combustible Total Mega","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295936210","lat":18.4800,"lng":-69.9500},
{"id":29,"name":"LOS ALCARRIZOS","city":"Los Alcarrizos","address":"Autopista Duarte, Kilometro 14. Tienda Garrido","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":null,"lat":18.5300,"lng":-69.9889},
{"id":30,"name":"LOS MINA","city":"Los Mina","address":"Av. San Vicente de Pa√∫l esq. Arzobispo Fern√°ndez de Navarrete, Estaci√≥n Total","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295475255","lat":18.4865,"lng":-69.8760},
{"id":31,"name":"LOS PRADOS","city":"Santo Domingo","address":"Av. Charles Summer #26 esq. Nicol√°s Ure√±a de Mendoza, Estaci√≥n Texaco","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295936213","lat":18.4800,"lng":-69.9200},
{"id":32,"name":"MADRE VIEJA","city":"San Crist√≥bal","address":"Carretera S√°nchez, Estaci√≥n SIGMA Madre Vieja","hours1":"10 am a 11 pm","hours2":"10 am a 11 pm","phone":null,"lat":18.4100,"lng":-70.1200},
{"id":33,"name":"MAM√Å TINGO","city":"Santo Domingo Norte","address":"Avenida Hermanas Mirabal casi esquina Calle Primera, Estaci√≥n Eco Petr√≥leo","hours1":"10 am a 11 pm","hours2":"10 am a 11 pm","phone":null,"lat":18.6000,"lng":-69.9500},
{"id":34,"name":"MOCA","city":"Moca","address":"Calle Duarte #61, estaci√≥n de combustibles Texaco Las Mercedes","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295473452","lat":19.4167,"lng":-70.4036},
{"id":35,"name":"PEDRO LIVIO CEDE√ëO","city":"Santo Domingo","address":"Av. Pedro Livio Cede√±o esq. Juan Pablo Duarte, Estaci√≥n Texaco","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295472794","lat":18.4800,"lng":-69.9200},
{"id":36,"name":"PEKIN","city":"Santiago","address":"Avenida Circunvalaci√≥n, esq. Urbanizaci√≥n Fernando Valerio. Estaci√≥n de combustible Texaco","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":null,"lat":19.4500,"lng":-70.7000},
{"id":37,"name":"PLAZA CEILO","city":"Herrera","address":"Av. 27 de Febrero #4, esq. Calle H. Plaza Ceilo, Herrera, Santo Domingo Oeste","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295936214","lat":18.4500,"lng":-69.9000},
{"id":38,"name":"POLANQUITO","city":"Santo Domingo","address":"Avenida Isabel Aguiar, no. 43, Estaci√≥n de combustible Total San Miguel","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":null,"lat":18.4700,"lng":-69.9300},
{"id":39,"name":"QUISQUEYA","city":"Santo Domingo","address":"Av. M√°ximo G√≥mez #205, estaci√≥n de combustibles Total Quisqueya","hours1":"9 am a 10 pm","hours2":"9 am a 11 pm","phone":"8295936211","lat":18.4700,"lng":-69.9300},
{"id":40,"name":"ROBERTO PASTORIZA","city":"Santo Domingo","address":"Avenida Roberto Pastoriza, n√∫mero 315, Plaza Uris, Ensanche Naco","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295936219","lat":18.4660,"lng":-69.9300},
{"id":41,"name":"R√ìMULO","city":"Bella Vista","address":"Av. R√≥mulo Betancourt #295, Bella Vista","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295936209","lat":18.4700,"lng":-69.9300},
{"id":42,"name":"SAN CRIST√ìBAL","city":"San Crist√≥bal","address":"Avenida Constituci√≥n, esquina Calle Mella, antiguo Banco del Progreso","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295472797","lat":18.4111,"lng":-70.1028},
{"id":43,"name":"SAN FCO. DE MACOR√çS","city":"San Francisco de Macor√≠s","address":"Avenida Libertad #67, parqueo del Supermercado Porvenir","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295472795","lat":19.3000,"lng":-70.2500},
{"id":44,"name":"SAN LUIS","city":"San Luis","address":"Carretera Mella, Esquina coraz√≥n de Jesus, Estaci√≥n PETRONAN San Luis","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":null,"lat":18.4500,"lng":-69.8600},
{"id":45,"name":"SAN PEDRO DE MACOR√çS","city":"San Pedro de Macor√≠s","address":"Avenida Rolando Mart√≠nez entre calle Jos√© A. Carburcia y Sergio A. Beras, Estaci√≥n de Combustible TEXACO","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295472439","lat":18.4663,"lng":-69.3086},
{"id":46,"name":"TELEF√âRICO","city":"Los Alcarrizos","address":"Estaci√≥n de combustibles Total Los Alcarrizos, Los Alcarrizos, Santo Domingo","hours1":"10 am a 11 pm","hours2":"10 am a 12 am","phone":null,"lat":18.5300,"lng":-69.9889},
{"id":47,"name":"VER√ìN - PUNTA CANA","city":"Punta Cana","address":"Carretera Ver√≥n Punta Cana, local 11. Marlin Shopping Center","hours1":"10 am a 12 am","hours2":"10 am a 12 am","phone":null,"lat":18.5686,"lng":-68.3630},
{"id":48,"name":"VILLA ALTAGRACIA","city":"Villa Altagracia","address":"Av. Juan Pablo Duarte, Estaci√≥n de Combustibles Shell","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295473218","lat":18.8454,"lng":-70.1746},
{"id":49,"name":"VILLA MELLA","city":"Villa Mella","address":"Ave. Charles de Gaulle #55 esq. Camino Real, Estaci√≥n de Combustible Total Los Pinos","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295936226","lat":18.5667,"lng":-69.8667},
{"id":50,"name":"ZONA UNIVERSITARIA","city":"Santo Domingo","address":"Av. Correa y Cidr√≥n esq. Padre Pina, pr√≥ximo a la UASD","hours1":"9 am a 10 pm","hours2":"9 am a 11 pm","phone":"8295936220","lat":18.4687,"lng":-69.8900},
{"id":51,"name":"AZUA (ADICIONAL)","city":"Azua","address":"Sucursal adicional - Avenida Duarte esquina Ntra Sra. de F√°tima","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":null,"lat":18.4560,"lng":-70.7440},
{"id":52,"name":"BAN√ç (ADICIONAL)","city":"Ban√≠","address":"KM. 1 1/2 carretera S√°nchez, Estaci√≥n Eco Petr√≥leo","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":null,"lat":18.3210,"lng":-70.2550},
{"id":53,"name":"BOCA CHICA (ADICIONAL)","city":"Boca Chica","address":"Autopista Las Am√©ricas km 29.5 Andr√©s Boca Chica - SIGMA La Caleta","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":"8295472198","lat":18.4419,"lng":-69.6323},
{"id":54,"name":"BONAO (ADICIONAL)","city":"Bonao","address":"Calle Duarte esquina doctor Columna - Estaci√≥n Atlantic","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":null,"lat":18.8290,"lng":-70.4019},
{"id":55,"name":"ESTACI√ìN CENTRAL (VARIOS)","city":"Santo Domingo","address":"Varias ubicaciones en estaciones de combustible se√±aladas","hours1":"10 am a 10 pm","hours2":"10 am a 11 pm","phone":null,"lat":18.4861,"lng":-69.9312}];

// Map setup
const map = L.map('map', {scrollWheelZoom:false, zoomControl:true}).setView([18.7,-69.9],7);

// usar tiles con aspecto suave (CartoDB Positron) para look limpio
L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors & CartoDB',
  maxZoom: 19
}).addTo(map);

// cluster grupo con estilo naranja
const markersCluster = L.markerClusterGroup({
  chunkedLoading: true,
  iconCreateFunction: function(cluster) {
    const count = cluster.getChildCount();
    const size = count < 10 ? 36 : (count < 100 ? 44 : 52);
    return L.divIcon({
      html: `<div style="width:${size}px;height:${size}px;line-height:${size}px;border-radius:50%;background:var(--cluster-bg);color:var(--cluster-text);font-weight:800;border:4px solid #fff">${count}</div>`,
      className: 'marker-cluster-small',
      iconSize: L.point(size, size)
    });
  }
});

const logoIcon = L.icon({
  iconUrl: 'logo.jpg',
  iconSize: [48,48],
  className: 'small-logo',
  iconAnchor: [24,48],
  popupAnchor: [0,-44]
});

const idToMarker = new Map();
branches.forEach(b=>{
  const marker = L.marker([b.lat,b.lng], {icon: logoIcon});
  const popupHtml = `<div style="min-width:200px;text-align:center"><strong style="color:${getComputedStyle(document.documentElement).getPropertyValue('--brand')};font-size:1.1rem">${escapeHtml(b.name)}</strong><div style="color:#555;font-size:13px;margin-top:8px">${escapeHtml(b.city)}</div><div style="margin-top:10px"><button onclick="openBranchFromPopup(${b.id})" style="background:var(--brand);color:#fff;border:0;padding:10px 16px;border-radius:8px;cursor:pointer;font-weight:700">Ver Detalles</button></div></div>`;
  marker.bindPopup(popupHtml, {minWidth:220, closeButton:true});
  markersCluster.addLayer(marker);
  idToMarker.set(b.id, marker);
});
map.addLayer(markersCluster);

(function fitBounds(){
  const coords = branches.map(b=>[b.lat,b.lng]);
  if(coords.length) {
    const bounds = L.latLngBounds(coords);
    map.fitBounds(bounds.pad(0.15), {maxZoom:8});
  }
})();

// UI Elements
const cardsEl = document.getElementById('cards');
const favoritesList = document.getElementById('favoritesList');
const emptyFavorites = document.getElementById('emptyFavorites');
const favoritesPanel = document.getElementById('favoritesPanel');
const countEl = document.getElementById('count');
const searchInput = document.getElementById('searchInput');
const searchBtn = document.getElementById('searchBtn');
const autocomplete = document.getElementById('autocomplete');

function formatPhone(p){ return p ? (p.replace(/(\d{3})(\d{3})(\d{4})/,'($1) $2-$3')) : ''; }
function escapeHtml(str){ return String(str||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

function getFavorites(){
  return JSON.parse(localStorage.getItem('lc_favs_v1')||'[]');
}

function renderFavorites(){
  const favs = getFavorites();
  favoritesList.innerHTML = '';
  
  if(favs.length === 0){
    emptyFavorites.style.display = 'block';
    favoritesList.style.display = 'none';
  } else {
    emptyFavorites.style.display = 'none';
    favoritesList.style.display = 'flex';
    
    const favBranches = branches.filter(b => favs.includes(b.id));
    favBranches.forEach(b=>{
      const item = document.createElement('div');
      item.className='fav-item';
      item.innerHTML = `
        <div class="fav-item-info">
          <h4>${escapeHtml(b.name)}</h4>
          <p>${escapeHtml(b.city)}</p>
        </div>
        <button class="fav-item-btn" data-id="${b.id}">Ordenar</button>`;
      
      item.querySelector('.fav-item-info').addEventListener('click', ()=> openBranchModalById(b.id));
      item.querySelector('.fav-item-btn').addEventListener('click', (e)=> {
        e.stopPropagation();
        openOrderChooser(b.id);
      });
      
      favoritesList.appendChild(item);
    });
  }
}

function render(list){
  cardsEl.innerHTML='';
  countEl.textContent = list.length;
  
  list.forEach(b=>{
    const card = document.createElement('div');
    card.className='branch-card';
    const isFav = getFavorites().includes(b.id);
    
    card.innerHTML = `
      <h3 data-id="${b.id}">${escapeHtml(b.name)}</h3>
      <div class="city">${escapeHtml(b.city)}</div>
      <div class="address">${escapeHtml(b.address)}</div>
      <div class="hours">
        <strong>Lunes‚ÄìMiercoles:</strong> ${escapeHtml(b.hours1)}<br>
        <strong>Jueves‚ÄìDomingo:</strong> ${escapeHtml(b.hours2)}
      </div>
      <div class="branch-actions">
        <button class="order-btn" data-id="${b.id}">üçï ORDENAR AQU√ç</button>
        <button class="fav-btn ${isFav?'active':''}" data-id="${b.id}">${isFav?'‚òÖ':'‚òÜ'}</button>
        <button class="map-btn" data-id="${b.id}" title="Ver en mapa">üìç</button>
      </div>`;
    
    cardsEl.appendChild(card);
  });

  cardsEl.querySelectorAll('h3').forEach(h=>{
    h.addEventListener('click', ()=> openBranchModalById(Number(h.dataset.id)));
  });
  
  cardsEl.querySelectorAll('.order-btn').forEach(btn=>{
    btn.addEventListener('click', (e)=> {
      e.stopPropagation();
      openOrderChooser(Number(btn.dataset.id));
    });
  });
  
  cardsEl.querySelectorAll('.fav-btn').forEach(btn=>{
    btn.addEventListener('click', (e)=> {
      e.stopPropagation();
      toggleFav(Number(btn.dataset.id));
    });
  });
  
  cardsEl.querySelectorAll('.map-btn').forEach(btn=>{
    btn.addEventListener('click', (e)=> {
      e.stopPropagation();
      const id = Number(btn.dataset.id);
      const branch = branches.find(b => b.id === id);
      if(branch){
        map.setView([branch.lat, branch.lng], 15);
        const marker = idToMarker.get(id);
        if(marker) marker.openPopup();
        window.scrollTo({top: 0, behavior: 'smooth'});
      }
    });
  });
}

function toggleFav(id){
  let f = getFavorites();
  if(f.includes(id)){ 
    f = f.filter(x=>x!==id); 
  } else { 
    f.push(id); 
  }
  localStorage.setItem('lc_favs_v1', JSON.stringify(f));
  render(branches.filter(b => startsWithMatch(b, normalizeQuery(searchInput.value))));
  renderFavorites();
}

function normalizeQuery(q){
  q = String(q||'').trim().toLowerCase();
  if(q === '1') q = 'a';
  return q;
}

function startsWithMatch(item, q){
  if(!q) return true;
  return (item.name || '').toLowerCase().startsWith(q) || (item.city || '').toLowerCase().startsWith(q);
}

function showAutocomplete(list){
  autocomplete.innerHTML = '';
  if(!list.length){ autocomplete.style.display='none'; return; }
  list.slice(0,8).forEach(b=>{
    const d = document.createElement('div');
    d.className = 'suggestion-item';
    d.textContent = b.name + ' - ' + b.city;
    d.addEventListener('click', ()=> {
      searchInput.value = b.name;
      autocomplete.style.display = 'none';
      performSelect(b.name);
    });
    autocomplete.appendChild(d);
  });
  autocomplete.style.display = 'block';
}

function performSelect(value){
  const q = normalizeQuery(value);
  const found = branches.find(b=>b.name.toLowerCase().startsWith(q) || b.city.toLowerCase().startsWith(q));
  if(found) {
    openBranchModal(found);
    clearSearchAfter(250);
  } else {
    clearSearchAfter(150);
  }
}

function clearSearchAfter(ms){
  setTimeout(()=>{ searchInput.value=''; autocomplete.style.display='none'; }, ms);
}

searchInput.addEventListener('input', e=>{
  const raw = e.target.value;
  const q = normalizeQuery(raw);
  if(q === '') {
    autocomplete.style.display='none';
    render(branches);
    updateClusterMarkers(branches);
    return;
  }
  const filtered = branches.filter(b => startsWithMatch(b,q));
  render(filtered);
  updateClusterMarkers(filtered);
  showAutocomplete(filtered);
});

searchInput.addEventListener('keydown', e=>{
  if(e.key === 'Enter'){
    const raw = e.target.value;
    const q = normalizeQuery(raw);
    const filtered = branches.filter(b => startsWithMatch(b,q));
    render(filtered);
    updateClusterMarkers(filtered);
    showAutocomplete(filtered);
    clearSearchAfter(350);
  }
});

searchBtn.addEventListener('click', ()=>{
  const raw = searchInput.value;
  const q = normalizeQuery(raw);
  const filtered = branches.filter(b => startsWithMatch(b,q));
  render(filtered);
  updateClusterMarkers(filtered);
  showAutocomplete(filtered);
  clearSearchAfter(350);
});

function updateClusterMarkers(list){
  markersCluster.clearLayers();
  list.forEach(b=>{
    const m = idToMarker.get(b.id);
    if(m) markersCluster.addLayer(m);
  });
  const coords = list.map(b=>[b.lat,b.lng]);
  if(coords.length){
    const bounds = L.latLngBounds(coords);
    map.fitBounds(bounds.pad(0.12), {maxZoom:10});
  }
}

// Branch Modal
const branchModal = document.getElementById('branchModal');
const bName = document.getElementById('bName');
const bAddress = document.getElementById('bAddress');
const bH1 = document.getElementById('bH1');
const bH2 = document.getElementById('bH2');
const bPhone = document.getElementById('bPhone');
const btnOrderHere = document.getElementById('btnOrderHere');
const btnFav = document.getElementById('btnFav');
const closeBranch = document.getElementById('closeBranch');
let branchMap = null;
let activeBranch = null;

function openBranchModalById(id){
  const b = branches.find(x=>x.id===id);
  if(b) openBranchModal(b);
}

function openBranchModal(b){
  activeBranch = b;
  bName.textContent = b.name;
  bAddress.textContent = b.address;
  bH1.textContent = b.hours1;
  bH2.textContent = b.hours2;
  bPhone.textContent = b.phone ? formatPhone(b.phone) : 'No disponible';
  
  const isFav = getFavorites().includes(b.id);
  btnFav.textContent = isFav ? '‚òÖ' : '‚òÜ';
  btnFav.className = isFav ? 'fav-btn active' : 'fav-btn';
  btnFav.setAttribute('data-id', b.id);

  branchModal.style.display='flex';
  branchModal.setAttribute('aria-hidden','false');

  setTimeout(()=>{
    if(branchMap){ branchMap.remove(); branchMap = null; }
    branchMap = L.map('branchMap', {
      zoomControl: true,
      attributionControl: false,
      dragging: true,
      tap: true
    }).setView([b.lat, b.lng], 16);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19,
  attribution: '¬© OpenStreetMap'
}).addTo(branchMap);

const fotos = ["little.jpg", "o.jpg", "cisar.jpg"];

// Asegurar que las im√°genes est√©n en la misma carpeta del HTML
const photoUrl = fotos[Math.floor(Math.random() * fotos.length)];


    const popupHtml = `
    <div style="min-width:220px;text-align:center">
      <img src="${photoUrl}" 
           alt="Sucursal Little Caesars" 
           style="width:100%;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.1)">
    </div>`;

    const marker = L.marker([b.lat, b.lng], {icon: logoIcon}).addTo(branchMap);
    marker.bindPopup(popupHtml).openPopup();
    branchMap.invalidateSize();
  }, 120);
}

function closeBranchModal(){
  branchModal.style.display='none';
  branchModal.setAttribute('aria-hidden','true');
  if(branchMap){ branchMap.remove(); branchMap = null; }
  activeBranch = null;
}

closeBranch.addEventListener('click', ()=> closeBranchModal());
branchModal.addEventListener('click', (ev)=> { if(ev.target === branchModal) closeBranchModal(); });

window.openBranchFromPopup = function(id){
  const b = branches.find(x=>x.id===id);
  if(b){
    openBranchModal(b);
    map.closePopup();
  }
};

// Order Modal
const orderModal = document.getElementById('orderModal');
const closeOrder = document.getElementById('closeOrder');
const uberBtn = document.getElementById('uberBtn');
const pyaBtn = document.getElementById('pyaBtn');

function openOrderChooser(branchId){
  sessionStorage.setItem('lc_selected_branch', branchId || '');
  orderModal.style.display='flex';
  orderModal.setAttribute('aria-hidden','false');
}

function closeOrderModal(){ 
  orderModal.style.display='none'; 
  orderModal.setAttribute('aria-hidden','true'); 
}

closeOrder.addEventListener('click', ()=> closeOrderModal());
orderModal.addEventListener('click', (ev)=>{ if(ev.target===orderModal) closeOrderModal(); });
uberBtn.addEventListener('click', ()=> { window.open('https://www.ubereats.com','_blank'); });
pyaBtn.addEventListener('click', ()=> { window.open('https://www.pedidosya.com','_blank'); });

btnOrderHere.addEventListener('click', ()=> {
  if(activeBranch) openOrderChooser(activeBranch.id); 
  else openOrderChooser(null);
});

btnFav.addEventListener('click', ()=>{
  if(!activeBranch) return;
  toggleFav(activeBranch.id);
  const isFav = getFavorites().includes(activeBranch.id);
  btnFav.textContent = isFav ? '‚òÖ' : '‚òÜ';
  btnFav.className = isFav ? 'fav-btn active' : 'fav-btn';
});

document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape'){
    if(orderModal.style.display === 'flex') closeOrderModal();
    else if(branchModal.style.display === 'flex') closeBranchModal();
  }
});

// Initial render
window.addEventListener('load', ()=>{
  render(branches);
  renderFavorites();
});
</script>
</body>
</html>